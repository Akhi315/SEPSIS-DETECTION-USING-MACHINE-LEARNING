#include <WiFi.h>

const char* ssid = "AJIET-WIFI";       // Your Wi-Fi network name (SSID)
const char* password = "WiFi@Ajiet";   // Your Wi-Fi password

WiFiServer server(80);  // Initialize the server on port 80

void setup() {
  // Start the Serial communication for debugging
  Serial.begin(115200);
  
  // Connecting to Wi-Fi
  Serial.println("Connecting to WiFi...");
  WiFi.begin(ssid, password);  // Start connecting to Wi-Fi

  // Wait until the ESP32 connects to the Wi-Fi
  while (WiFi.status() != WL_CONNECTED) {
    delay(1000);  // Wait for 1 second
    Serial.println("Attempting to connect to WiFi...");
  }

  // Once connected, print the IP address
  Serial.println("Connected to WiFi!");
  Serial.print("IP Address: ");
  Serial.println(WiFi.localIP());  // Print the ESP32's IP address

  // Start the web server
  server.begin();
}

void loop() {
  WiFiClient client = server.available();  // Listen for incoming clients

  if (client) {
    Serial.println("New client connected!");

    String request = "";
    while (client.available()) {
      char c = client.read();
      request += c;
    }

    Serial.println(request);  // Print the client's request

    // HTTP Response
    String response = "HTTP/1.1 200 OK\r\n";
    response += "Content-Type: text/html\r\n";
    response += "Connection: close\r\n\r\n";
    response += "<!DOCTYPE HTML>\r\n";
    response += "<html>\r\n";
    response += "<body>\r\n";
    response += "<h1>ESP32 Sepsis Prediction</h1>\r\n";
    response += "<p>IP Address: " + String(WiFi.localIP()) + "</p>\r\n";
    response += "</body>\r\n";
    response += "</html>\r\n";

    client.print(response);  // Send the response to the client

    delay(1);
    client.stop();  // Close the connection
    Serial.println("Client disconnected");
  }
}
